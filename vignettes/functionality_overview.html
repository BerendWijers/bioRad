<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Adriaan Dokter" />


<title>Overview of bioRad functionality</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Overview of bioRad functionality</h1>
<h4 class="author"><em>Adriaan Dokter</em></h4>
<h4 class="date"><em>April 2018</em></h4>



<div id="exercise-1" class="section level1">
<h1>Exercise 1</h1>
<div id="preparation" class="section level2">
<h2>1.1. Preparation</h2>
<p>Throughout the practical we will use the bioRad R package. It’s currently not (yet) in the default CRAN repository, but can be downloaded from Github. See <a href="https://github.com/adokter/bioRad" class="uri">https://github.com/adokter/bioRad</a> for install instructions. Go through steps 1-3 of these install instructions if you haven’t done so already.</p>
<p>Execute each of the code examples provided below in Rstudio, and try to complete the exercises.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make sure you start with a fresh R session</span>
<span class="co"># load the bioRad package</span>
<span class="kw">library</span>(bioRad)
<span class="co"># check the package version</span>
<span class="kw">packageVersion</span>(<span class="st">&quot;bioRad&quot;</span>)
<span class="co"># make sure you have the latest version (0.3.0). If you have an older version, update as follows:</span>
<span class="kw">library</span>(devtools)
devtools::<span class="kw">install_github</span>(<span class="st">&quot;adokter/bioRad@ecography&quot;</span>)</code></pre></div>
<p>All the functions of the bioRad package have fairly elaborated manual pages, that you can refer to at any moment:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bring up the package general help page:</span>
?bioRad</code></pre></div>
<p>In the help window, you can click on each of the links to pull up help pages of specific functions. Click on the <code>Index</code> link at the bottom of each help page to get an overview of all functions and available manual pages.</p>
<p>Start by making a new directory on your local machine that you will use for this practical</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make a new local directory on your machine where to download data for this practical</span>
<span class="co"># replace the string below with the path of that directory:</span>
HOME=<span class="st">&quot;your/personal/working/directory/&quot;</span>
<span class="co"># check that the directory exists. If the next statement evaluates to FALSE, something went wrong: the directory does not exist or you didn't specify its path correctly</span>
<span class="kw">file.exists</span>(HOME)
<span class="co"># we will make HOME our work directory, the default folder in which R will look</span>
<span class="co"># for files, and where it will output newly generated files.</span>
<span class="kw">setwd</span>(HOME)
<span class="co"># Finally, we set the local time zone to UTC, so all plotted time axes will be in UTC</span>
<span class="kw">Sys.setenv</span>(<span class="dt">TZ=</span><span class="st">&quot;UTC&quot;</span>)</code></pre></div>
<p>Your R session is now properly set up</p>
<p>To work with US NEXRAD data, bioRad currently require a working installation of Docker (linux / mac) or Docker for Windows (<strong>not</strong> Docker Toolbox, this is an older implementation of Docker for Windows operating systems that is not supported). If you managed to successfully install Docker, test whether it works</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># start your local Docker installation</span>
<span class="co"># we first test whether R can communicate with Docker:</span>
<span class="kw">check_docker</span>()</code></pre></div>
<p>If you get a “Hello from Docker!” welcome message, everything is working.</p>
<p>If you did <strong>not</strong> manage to install Docker, you will not be able to load NEXRAD data into R at this time, but you will be able to continue the exercises with European radar data that can be loaded without Docker.</p>
</div>
<div id="downloading-and-loading-polar-volume-data" class="section level2">
<h2>1.2. Downloading and loading polar volume data</h2>
<p>US NEXRAD data can be accessed in the <a href="https://s3.amazonaws.com/noaa-nexrad-level2/index.html">Amazon cloud</a></p>
<p>Let us download <a href="https://noaa-nexrad-level2.s3.amazonaws.com/2017/10/25/KPAH/KPAH20171025_040338_V06">this polar volume file</a> for the KPAH radar (Paducah, KY), and store it in your working directory.</p>
<p>If you don’t have a working docker container, you can download <a href="https://www.dropbox.com/s/r920kzslzgo17el/volume.h5?dl=0">this polar volume file</a>, and store it in your working directory. It’s the same file but in a different format (only difference is that it contains only data up to 35 km range)</p>
</div>
<div id="the-structure-of-polar-volumes" class="section level2">
<h2>1.3. The structure of polar volumes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  let's read in the downloaded volume:</span>
file.in=<span class="st">&quot;KPAH20171025_040338_V06&quot;</span>
<span class="co"># or in case you downloaded the file that doesn't require docker, the filename is different:</span>
file.in=<span class="st">&quot;volume.h5&quot;</span>
<span class="co"># check that the file is stored in the right location:</span>
<span class="kw">file.exists</span>(file.in)
<span class="co"># load the polar volume:</span>
pvol=<span class="kw">read_pvolfile</span>(file.in)
## print some information about the polar volume
pvol
<span class="co"># print information about the polar scans contained in this polar volume:</span>
pvol$scans</code></pre></div>
</div>
<div id="inspecting-radar-scans-sweeps" class="section level2">
<h2>1.4. Inspecting radar scans (sweeps)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># let's extract the third scan, which was collected at 0.48 degree elevation:</span>
pscan =<span class="st"> </span>pvol$scans[[<span class="dv">1</span>]]
<span class="co"># print some information about this scan:</span>
pscan
<span class="co"># before we can plot the scan, we need to project it on a Cartesian grid,</span>
<span class="co"># i.e. we need to make a Plan Position Indicator (PPI)</span>
my_ppi =<span class="st"> </span><span class="kw">project_as_ppi</span>(pscan,<span class="dt">cellsize=</span><span class="dv">1000</span>,<span class="dt">range.max=</span><span class="dv">25000</span>)
<span class="co"># print some information about this ppi:</span>
<span class="kw">str</span>(my_ppi)
<span class="co"># you can see we projected it on a 500 metre grid.</span>
<span class="co"># Check the manual of the ppi function to see how you can change the projection</span>
<span class="co"># Now we are ready to plot the ppi</span>
<span class="co"># plot the reflectivity factor image:</span>
<span class="kw">plot</span>(my_ppi, <span class="dt">param=</span><span class="st">&quot;VRADH&quot;</span>,<span class="dt">zlim=</span><span class="kw">c</span>(-<span class="dv">30</span>,<span class="dv">30</span>))
<span class="co"># see plot.ppi for all the plot options for a ppi object:</span>
?plot.ppi</code></pre></div>
</div>
<div id="overlaying-radar-scans-on-maps" class="section level2">
<h2>1.5. Overlaying radar scans on maps</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># It is often informative to plot radar data on a base layer, such as google earth maps.</span>
<span class="co"># first download the background image:</span>
satelliteImage=<span class="kw">download_basemap</span>(my_ppi,<span class="dt">maptype=</span><span class="st">&quot;satellite&quot;</span>)
<span class="co"># then overlay the PPI on the satellite image:</span>
<span class="kw">map</span>(my_ppi,<span class="dt">param=</span><span class="st">&quot;DBZH&quot;</span>,<span class="dt">map=</span>satelliteImage, <span class="dt">zlim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">15</span>))
<span class="co"># Note that in R, spatial data is often contained in class objects of packag 'sp'</span>
<span class="co"># bioRad also uses these objects in the background, and they can be extracted if you want to.</span>
<span class="co"># The spatial data is stored in the data slot, as in:</span>
my_spatialgrid=my_ppi$data
<span class="co"># you can use the sp package to save the spatial data to all kinds GIS formats, for example ArcGis:</span>
<span class="kw">library</span>(sp)
<span class="kw">write.asciigrid</span>(my_spatialgrid,<span class="st">&quot;PPI_in_arcgis_format.asc&quot;</span>)</code></pre></div>
</div>
</div>
<div id="exercise-2" class="section level1">
<h1>Exercise 2</h1>
<div id="processing-polar-volume-data-into-vertical-profiles" class="section level2">
<h2>2.1. Processing polar volume data into vertical profiles</h2>
<p>We will generate vertical profiles with the automated algorithm vol2bird (<a href="https://github.com/adokter/vol2bird" class="uri">https://github.com/adokter/vol2bird</a>), which is included in the bioRad package. You need a working installation of Docker (linux / mac) or Docker for Windows (<strong>not</strong> Docker Toolbox, this is an older implementation of Docker for Windows operating systems that is not supported).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we will process the same file as in section 1.3:</span>
file.in
<span class="co"># check whether the file is still there:</span>
<span class="kw">file.exists</span>(file.in)
<span class="co"># run vol2bird</span>
vp=<span class="kw">calculate_vp</span>(file.in,<span class="dt">range.max=</span><span class="dv">35000</span>,<span class="dt">sd_vvp=</span><span class="dv">1</span>,<span class="dt">dealias=</span>T,<span class="dt">dualpol=</span>T)
<span class="co"># vp is now a 'vp', a vertical profile</span>
vp
<span class="co"># alternatively, you may also store the profile on disk as a hdf5 file, which is what we will do next:</span>
<span class="co"># let's first define the name of the output file (we paste the extention &quot;.h5&quot; to the name)</span>
file.out=<span class="kw">paste</span>(file.in,<span class="st">&quot;.h5&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="co"># print the newly generated output file name to which we will write:</span>
<span class="co"># note that this is only a string, you can give it any other name if you want to</span>
file.out
<span class="co"># finally, run vol2bird; this generates an output file as specified in file.out</span>
<span class="co"># we set autoconf to TRUE, to let vol2bird figure out the optimal settings by itself</span>
<span class="kw">calculate_vp</span>(file.in,file.out,<span class="dt">range.max=</span><span class="dv">35000</span>,<span class="dt">sd_vvp=</span><span class="dv">1</span>,<span class="dt">dealias=</span>T,<span class="dt">dualpol=</span>T)
<span class="co"># your work directory should now contain a new file with the name you specified in file.out</span>
<span class="co"># check that we can read this file, and retrieve the vertical profile from it:</span>
vp=<span class="kw">read_vpfiles</span>(file.out)</code></pre></div>
</div>
<div id="inspecting-single-vertical-profiles" class="section level2">
<h2>2.2. Inspecting single vertical profiles</h2>
<p>Now that you have loaded a list of vertical profiles, we can start exploring them. We will start with plotting and inspecting single vertical profiles, i.e. a single profile from the vplist object you have just loaded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the vertical profile, in terms of reflectivity factor</span>
<span class="kw">plot</span>(vp, <span class="dt">quantity=</span><span class="st">&quot;dbz&quot;</span>)
<span class="co"># plot the vertical profile, in terms of reflectivity</span>
<span class="kw">plot</span>(vp, <span class="dt">quantity=</span><span class="st">&quot;eta&quot;</span>)</code></pre></div>
<p>These two plots look very different, but they are twice the same data plotted on a different scale.</p>
<pre><code>eta = (radar-wavelength dependent constant) * 10^(dbz/10)</code></pre>
<p>So <code>eta</code> and <code>dbz</code> are closely related, the main difference is that reflectivity factors are logarithmic, and reflectivities linear.</p>
<p>The reflectivity factor <code>dbz</code> is the quantity used by most meteorologist. It has the useful property that at different radar wavelengths (e.g. S-band versus C-band) the same amount of precipitation shows up at equal reflectivity factors. The same holds for insects, as well as any other target that is much smaller than the radar wavelength (S-band = 10 cm, C-band = 5 cm), the so-called Rayleigh-scattering limit</p>
<p>In the case of birds we are outside the Rayleigh limit, because birds are of similar size as the radar wavelength. In this case the reflectivity <code>eta</code> is more similar between S-band and C-band (though might be a little different). <code>eta</code> is also more directly related to the density of birds, since <code>eta</code> can be expressed as (bird density) x (radar cross section per bird). For these two reasons, for weather radar ornithologists reflectivity <code>eta</code> is the more conventional unit (instead of reflectivity factor in dBZ).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print the currently assumed radar cross section (RCS) per bird:</span>
<span class="kw">rcs</span>(vp)
<span class="co"># plot the vertical profile, in terms of bird density</span>
<span class="kw">plot</span>(vp, <span class="dt">quantity=</span><span class="st">&quot;dens&quot;</span>)</code></pre></div>
<p>We can change the assumed radar cross section as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># let's change the RCS to 110 cm^2</span>
<span class="kw">rcs</span>(vp) =<span class="st"> </span><span class="dv">110</span>
<span class="kw">plot</span>(vp, <span class="dt">quantity=</span><span class="st">&quot;dd&quot;</span>)</code></pre></div>
</div>
</div>
<div id="exercise-3" class="section level1">
<h1>Exercise 3</h1>
<div id="loading-processed-vertical-profiles" class="section level2">
<h2>3.1. Loading processed vertical profiles</h2>
<p>To save some time, we will continue with some pre-processed vertical profiles for the KPAH radar.</p>
<p>Navigate to <a href="https://www.dropbox.com/s/6em8s4yjqutkfle/profiles.zip?dl=0" class="uri">https://www.dropbox.com/s/6em8s4yjqutkfle/profiles.zip?dl=0</a> and download the processed profiles, <code>profiles.zip</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># unzip the profiles.zip file, either by clicking the file or the command below; after unzipping you should have a folder 'profiles' with processed data</span>
<span class="co"># load all the filenames in the new 'profiles' subfolder in your working directory</span>
vp_paths=<span class="kw">dir</span>(<span class="st">&quot;./profiles&quot;</span>, <span class="dt">recursive=</span><span class="ot">TRUE</span>,<span class="dt">full.names=</span><span class="ot">TRUE</span>)
vp_paths
<span class="co"># read these vertical profiles (hdf5 files) into R (may take a minute to load)</span>
vplist=<span class="kw">read_vpfiles</span>(vp_paths)
<span class="co"># print some information on the vplist object. It should contain 71 profiles </span>
vplist
<span class="co"># save the object, which allows you to load the data more quickly next time</span>
<span class="kw">save</span>(vplist,<span class="dt">file=</span><span class="st">&quot;vplist.RData&quot;</span>)
<span class="co"># you can restore the vplist object at any time as follows:</span>
<span class="kw">load</span>(<span class="st">&quot;vplist.RData&quot;</span>)</code></pre></div>
</div>
<div id="plotting-time-series-data" class="section level2">
<h2>3.2. Plotting time series data</h2>
<p>We will now examine multiple vertical profiles at once that are ordered into a time series, e.g. the vertical profiles obtained from a single radar over a full day.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert the list of vertical profiles into a time series:</span>
<span class="co"># In case your vplist contains profiles of different radars, this function will</span>
<span class="co"># group the profiles and make a separate time-series for each radar.</span>
<span class="co"># (but in our case we have profiles for only one radar)</span>
ts=<span class="kw">vplist_to_vpts</span>(vplist)
<span class="co"># print summary information</span>
ts
<span class="co"># plot the time series in terms of reflectivity factors, from 0-2000 metre altitude:</span>
<span class="kw">plot</span>(ts, <span class="dt">quantity=</span><span class="st">&quot;dbz&quot;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>))
<span class="co"># plot the time series in terms of bird density:</span>
<span class="kw">plot</span>(ts, <span class="dt">quantity=</span><span class="st">&quot;dens&quot;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>))
<span class="co"># change the radar cross-section works the same as for single vertical profiles, for example:</span>
<span class="kw">rcs</span>(ts)=<span class="dv">20</span>
<span class="co"># check the help file for more plotting options</span>
<span class="co"># Because profile timeseries are of class 'vpts', it's associated plotting function</span>
<span class="co"># is plot.vpts:</span>
?plot.vpts</code></pre></div>
<p>To interpret the wind barbs in the profile time series figure: each half flag represents 2.5 m/s, each full flag 5 m/s, each pennant (triangle) 25 m/s.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># time series objects can be subsetted, just as you may be used to with vectors</span>
<span class="co"># here we subset the first 50 timesteps:</span>
ts[<span class="dv">1</span>:<span class="dv">50</span>]</code></pre></div>
<p>Precipitation is known to have a major influence on the timing and intensity of migration, therefore it can be useful to inspect profiles for presence of precipitation. An easy way of doing that is plotting the vertical profile of total reflectivity (quantity DBZH), which includes everything: birds, insects and precipitation. Precipitation often has higher reflectivities than birds, and also extends to much higher altitudes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the time series</span>
<span class="kw">plot</span>(ts, <span class="dt">quantity=</span><span class="st">&quot;DBZH&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You can also extract the data from bioRad's class objects into a simple R format:</span>
<span class="co">#</span>
<span class="co"># Extract some data from the time series, e.g. the bird density</span>
<span class="kw">get_quantity</span>(ts, <span class="dt">quantity=</span><span class="st">&quot;dens&quot;</span>)
<span class="co"># convert all the data in the time series to a standard data.frame:</span>
my_dataframe=<span class="kw">as.data.frame</span>(ts)
my_dataframe</code></pre></div>
</div>
<div id="vertical-integration-surface-density-migration-traffic-rate" class="section level2">
<h2>3.3 Vertical integration: surface density &amp; migration traffic rate</h2>
<p>Often you will want to sum together all the migrants in the vertical dimension, for example if you want a single index of how many birds are migrating at a certain instant. There are at least two ways in which you can do that</p>
<ul>
<li>by calculating the vertically integrated bird density (VID), which is <em>surface</em> density as opposed to a <em>volume</em> densities you have been plotting in the previous exercises: this number gives you how many migrants are aloft per square kilometer earth’s surface (unit individuals/km<span class="math inline">\(^{2}\)</span>), and is a vertical integration of the volume densities (unit individuals/km<span class="math inline">\(^{3}\)</span>).</li>
<li>Note that the VID quantity doesn’t depend on the speed of the migrants. A common measure that reflects both the density and speed of the migration is migration traffic rate (MTR). This is flux measure that gives you how many migrants are passing the radar station per unit of time and per unit of distance perpendicular to the migratory direction (unit individuals/km/hour).</li>
</ul>
<p>We will be using bioRad’s <code>integrate_profile</code> function to calculate these quantities</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's continue with the ts object created in the previous example.</span>
<span class="co"># The vertically integrated quantities are calculated as follows:</span>
integrated.ts =<span class="st"> </span><span class="kw">integrate_profile</span>(ts)
<span class="co"># plot the integrated data to screen:</span>
integrated.ts
<span class="co"># The integrated.ts object you created is a vpi class object, which is an acronym for Vertical Profiles Integrated. It has its own plot method, which by default plots migration traffic rate (MTR):</span>
<span class="kw">plot</span>(integrated.ts)
<span class="co"># you can also plot vertically integrated densities (VID):</span>
<span class="kw">plot</span>(integrated.ts, <span class="dt">quantity=</span><span class="st">&quot;vid&quot;</span>)</code></pre></div>
<p>Now let’s calculate how many birds passed over the radar during the full time series:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's continue with the ts object created in the previous example.</span>
<span class="co"># we can integrate all the traffic rates [unit: birds/km/h] over time, to obtain the number of birds that</span>
<span class="co"># have passed over the radar [unit: birds/km]. Like the traffic rates, these numbers are calculated for </span>
<span class="co"># a 1 km transect perpendicular to the migratory direction, and stored in column mt of the object:</span>
<span class="kw">plot</span>(integrated.ts, <span class="dt">quantity=</span><span class="st">&quot;mt&quot;</span>)</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
