<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guidelines to load bird profiles into bioRad from ENRAM repository • bioRad</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">bioRad</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro_ppi.html">Create PPI plots from polar volume files</a>
    </li>
    <li>
      <a href="../articles/intro_vp.html">Load bird profiles into bioRad from ENRAM data repository</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adokter/bioRad">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Guidelines to load bird profiles into bioRad from ENRAM repository</h1>
                        <h4 class="author">Liesbeth Verlinden, Peter Desmet, Stijn Van Hoey</h4>
            
            <h4 class="date">January 2017</h4>
          </div>

    
    
<div class="contents">
<p>This document gives an introduction how to access and load weather radar bird profiles into the R package <a href="https://github.com/adokter/bioRad#biorad">bioRad</a>. This process is done in two steps:</p>
<ol style="list-style-type: decimal">
<li>Downloading the data.</li>
<li>Loading the data into bioRad.</li>
</ol>
<div id="downloading-bird-profile-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-bird-profile-data" class="anchor"></a>1. Downloading bird profile data</h2>
<p>The bird profiles, generated by the <a href="https://github.com/adokter/vol2bird#vol2bird-algorithm">vol2bird algorithm</a>, are available in this <a href="http://enram.github.io/data-repository/">data repository</a>. The repository is structured in the following way:</p>
<pre><code>    └──
      country
        └── radar
              └── year
                    └── month
                          └── day
                               └── hour
                                     └── filename: dkrom_vp_20170114231500.h5</code></pre>
<p>The name of the file consist of three parts:</p>
<ul>
<li>Country and radar code: the first two letters give the country, the last three the radar. The abbrevation is based on the <a href="http://eumetnet.eu/wp-content/themes/aeron-child/observations-programme/current-activities/opera/database/OPERA_Database/index.html">ODIM code</a>.</li>
<li>vp: abbrevation of vertical profile.</li>
<li>Time and date: YYYYMMDDHHMMSS.</li>
</ul>
<div id="manually-downloading-bird-profile-data" class="section level3">
<h3 class="hasAnchor">
<a href="#manually-downloading-bird-profile-data" class="anchor"></a>Manually downloading bird profile data</h3>
<p>There are two ways to manually download the profiles:</p>
<ul>
<li>One by one.</li>
<li>As a zip file containing all monthly data for a radar. These zip files are available in the year directories of each radar.</li>
</ul>
<p>When unpacking the zip files after download, the data will be structured in the same hierarchy of directories as on the repository:</p>
<pre><code>  └── month
        └── day
             └── hour
                   └── filename: dkrom_vp_20170114231500.h5</code></pre>
</div>
<div id="biorad-bird-profile-download-function" class="section level3">
<h3 class="hasAnchor">
<a href="#biorad-bird-profile-download-function" class="anchor"></a>BioRad bird profile download function</h3>
<p>The <code>download_vp</code> function provided with the BioRad function supports the download of a set of zip files, defined by a start date, end date, country and radar. As an example, here is how you can download the available data of October and November 2016 for two Belgian radars to the current working directory:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/download_vp.html">download_vp</a></span>(<span class="st">"2016-10-01"</span>, <span class="st">"2016-11-30"</span>, <span class="kw">c</span>(<span class="st">"be"</span>), 
            <span class="kw">c</span>(<span class="st">"jab"</span>, <span class="st">"wid"</span>), <span class="dt">localpath =</span> <span class="st">"."</span>)</code></pre></div>
<pre><code>## [1] "no data available at URL https://lw-enram.s3-eu-west-1.amazonaws.com/be/jab/2016/bejab201610.zip"
## [1] "no data available at URL https://lw-enram.s3-eu-west-1.amazonaws.com/be/wid/2016/bewid201610.zip"
## [1] "Downloading file bejab201611.zip"
## [1] "Downloading file bewid201611.zip"</code></pre>
</div>
</div>
<div id="loading-bird-profile-data-into-biorad" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-bird-profile-data-into-biorad" class="anchor"></a>2. Loading bird profile data into bioRad</h2>
<p>Once the data is downloaded in your directory, you have two ways to load the data into bioRad.</p>
<ul>
<li>As a single file.</li>
<li>As several single files at the same time.</li>
</ul>
<p>Below is some example code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read single bird profile</span>
vp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readvp.html">readvp</a></span>(<span class="st">"PATH/TO/FILE.h5"</span>)
<span class="co"># read several single bird profiles</span>
vp.list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readvp.list.html">readvp.list</a></span>(<span class="st">"PATH/TO/FILE1.h5"</span>, <span class="st">"PATH/TO/FILE2.h5"</span>, 
                       <span class="st">"PATH/TO/FILE3.h5"</span>)</code></pre></div>
<p>An additional function <code>retrieve_vp_paths</code> will allow you to browse through the data directories and select many paths to bird profiles based on country, radar, and a specified time frame, which then can be passed to the <code>readvp.list</code> function.</p>
<p>The abbrevations of country and radar are the same as used in the ODIM code, see explanation under <em>Section 1. Downloading bird profile data</em>.</p>
<p>Below are examples of which combinations of arguments you can use to select specific bird profiles.</p>
<div id="general" class="section level3">
<h3 class="hasAnchor">
<a href="#general" class="anchor"></a>General</h3>
<p>If no arguments are specified, the paths of <em>all vp files in the directories</em> will be added to the list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files in the directories</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>)</code></pre></div>
</div>
<div id="location" class="section level3">
<h3 class="hasAnchor">
<a href="#location" class="anchor"></a>Location</h3>
<p>Only specifying the country selects the paths of the vp files of <em>all radars of that country</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files of all radars in Belgium</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, <span class="dt">country =</span> <span class="st">"be"</span>)</code></pre></div>
<p>Specifying the radar selects <em>all vp files of that radar</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files of the radar 'Jabbeke'</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, <span class="dt">radar =</span> <span class="st">"jab"</span>)</code></pre></div>
<p>You can also specify <em>several radars within a country</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files of the French radars Momuy, Nancy and Bordeau</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, 
                                <span class="dt">radar =</span> <span class="kw">c</span>(<span class="st">"mom"</span>, <span class="st">"nan"</span>, <span class="st">"bor"</span>))</code></pre></div>
<p>You CANNOT specify <em>all radars via the country</em> argument and then add radars <em>of another country</em> by the radar argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files af all Belgian radars and the French radars Momuy, Nancy and Bordeau</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, 
                                <span class="dt">country =</span> <span class="st">"be"</span>, <span class="dt">radar =</span> <span class="kw">c</span>(<span class="st">"mom"</span>, <span class="st">"nan"</span>, <span class="st">"bor"</span>))
## WRONG!! ##</code></pre></div>
</div>
<div id="time" class="section level3">
<h3 class="hasAnchor">
<a href="#time" class="anchor"></a>Time</h3>
<p>You can specify a time frame using the start_date and end_date arguments, which takes integer values in the following format: “YYYY-MM-DD”. See the example below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files of all Swiss radars from Nov/2016 till Jan/2017</span>
list.paths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, 
                                <span class="dt">country =</span> <span class="st">"cz"</span>, 
                                <span class="dt">start_date =</span> <span class="st">"2016-11-01"</span>, 
                                <span class="dt">end_date =</span> <span class="st">"2017-01-31"</span>)</code></pre></div>
<p><em>Special case</em>: if you want the paths to profiles for a <em>certain month across all years</em>, you will have to call the <code>retrieve_data_range</code> fuction several times across the years and put the outcomes together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read paths of all vp files of all Swiss radars for Nov/16</span>
list.paths16 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, 
                                  <span class="dt">country =</span> <span class="st">"ch"</span>, 
                                  <span class="dt">start_date =</span> <span class="st">"2016-11-01"</span>, 
                                  <span class="dt">end_date =</span> <span class="st">"2016-11-31"</span>)
<span class="co"># read paths of all vp files of all Swiss radars for Nov/17</span>
list.paths17 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/retrieve_vp_paths.html">retrieve_vp_paths</a></span>(<span class="dt">path =</span> <span class="st">"PATH/TO/DATA-DIR"</span>, 
                                  <span class="dt">country =</span> <span class="st">"ch"</span>, 
                                  <span class="dt">start_date =</span> <span class="st">"2017-11-01"</span>, 
                                  <span class="dt">end_date =</span> <span class="st">"2017-11-31"</span>)
<span class="co"># put paths together </span>
list.path &lt;-<span class="st"> </span><span class="kw">c</span>(list.paths16, list.paths17)</code></pre></div>
</div>
<div id="append-paths-with-relative-path-to-data-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#append-paths-with-relative-path-to-data-directory" class="anchor"></a>Append paths with relative path to data directory</h3>
<p>The paths in the <code>list.path</code> will only start from your data directory. If you want relative paths (e.g. from your script), you can do so by appending the paths with the path to your data repository:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">list.full_paths &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"PATH/TO/DATA-DIR"</span>, list.paths)</code></pre></div>
<p>Once the list with paths is created, it can be added to the <code>readvp.list</code> function to create a list of VP’s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#make list of bird profiles with list of their paths</span>
vp.list2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readvp.list.html">readvp.list</a></span>(list.full_paths)</code></pre></div>
</div>
</div>
<div id="introduction-to-plotting-in-biorad" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-plotting-in-biorad" class="anchor"></a>3. Introduction to plotting in bioRad</h2>
<p>The bioRad package allows to plot PPI’s, VP’s and VPB’s.</p>
<div id="vp" class="section level3">
<h3 class="hasAnchor">
<a href="#vp" class="anchor"></a>VP</h3>
<p>BioRad also allows to plot the bird profiles, see example code below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load in an example bird profile</span>
<span class="kw">data</span>(VP)
<span class="co"># plot bird profile</span>
<span class="kw">plot</span>(VP, <span class="dt">line.col =</span> <span class="st">'blue'</span>)</code></pre></div>
<p><img src="intro_vp_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div id="vpb-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#vpb-plots" class="anchor"></a>VPB plots</h3>
<p>The package provides a function to plot vertical profiles of birds (VPB) too. This function takes in time series of bird profiles, which can be generated by the function <code>vpts</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make time series from all vertical profiles in a list</span>
vpts.be &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vpts.html">vpts</a></span>(vp.list2)
<span class="co"># make time series from all vertical profiles of the 'Jabbeke' radar</span>
vpts.jab &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vpts.html">vpts</a></span>(vp.list2, <span class="dt">radar =</span> <span class="st">"jab"</span>)</code></pre></div>
<p>Note that, to be able to plot the time series, these need to be regular. The function <code>regularize</code> regularizes the times series on a grid, with option to specify the time interval:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># regularize the time series on a 5 minute interval grid</span>
vpts.jab.reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/regularize.html">regularize</a></span>(vpts.jab, <span class="dt">interval =</span> <span class="dv">15</span>)</code></pre></div>
<p>Below is example code of how to make a VPB plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># locate example file</span>
VPtable &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"VPtable.txt"</span>, <span class="dt">package =</span> <span class="st">"bioRad"</span>)
<span class="co"># load and regularize time series of vertical profiles</span>
ts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/regularize.html">regularize</a></span>(<span class="kw"><a href="../reference/readvp.table.html">readvp.table</a></span>(VPtable, <span class="dt">radar =</span> <span class="st">"KBGM"</span>, <span class="dt">wavelength =</span> <span class="st">'S'</span>))</code></pre></div>
<pre><code>## projecting on 360 seconds interval grid...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot density of individuals for the first 500 time steps, in the altitude layer 0-3000 m.</span>
<span class="kw">plot</span>(ts[<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>], <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3000</span>))</code></pre></div>
<p><img src="intro_vp_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot total reflectivity factor (rain,birds,insects together):</span>
<span class="kw">plot</span>(ts[<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>], <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3000</span>), <span class="dt">quantity =</span> <span class="st">"DBZH"</span>)</code></pre></div>
<p><img src="intro_vp_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
<p>More functionallity of the package bioRad, such as adjusting the radar cross section and calculating migration traffic rates, can be find in its documentation.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#downloading-bird-profile-data">1. Downloading bird profile data</a></li>
      <li><a href="#loading-bird-profile-data-into-biorad">2. Loading bird profile data into bioRad</a></li>
      <li><a href="#introduction-to-plotting-in-biorad">3. Introduction to plotting in bioRad</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adriaan M. Dokter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
